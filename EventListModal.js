import { __awaiter } from "tslib";
import { Modal } from 'obsidian';
export class EventListModal extends Modal {
    constructor(app, eventManager, date, onEdit, onUpdate) {
        super(app);
        this.eventManager = eventManager;
        this.date = date;
        this.onEdit = onEdit;
        this.onUpdate = onUpdate;
    }
    onOpen() {
        const { contentEl } = this;
        contentEl.empty();
        contentEl.addClass('calendar-event-list-modal');
        // Modal title
        contentEl.createEl('h2', { text: `Events for ${this.date}` });
        // Get events for this date
        const events = this.eventManager.getEventsForDate(this.date);
        if (events.length === 0) {
            contentEl.createDiv({
                cls: 'calendar-no-events',
                text: 'No events scheduled'
            });
        }
        else {
            const listContainer = contentEl.createDiv({ cls: 'calendar-event-list' });
            events.forEach((event, index) => {
                this.renderEventItem(listContainer, event, index);
            });
        }
        // Close button
        const buttonContainer = contentEl.createDiv({ cls: 'modal-button-container' });
        const closeBtn = buttonContainer.createEl('button', { text: 'Close' });
        closeBtn.addEventListener('click', () => this.close());
    }
    renderEventItem(container, event, index) {
        const eventItem = container.createDiv({ cls: 'calendar-event-item' });
        // Color indicator
        const colorBar = eventItem.createDiv({ cls: 'calendar-event-color-bar' });
        colorBar.style.backgroundColor = event.color;
        // Event content (clickable to edit)
        const eventContent = eventItem.createDiv({ cls: 'calendar-event-content' });
        if (event.time) {
            eventContent.createDiv({ cls: 'calendar-event-time', text: event.time });
        }
        eventContent.createDiv({
            cls: 'calendar-event-title',
            text: event.title || 'Untitled Event'
        });
        if (event.desc) {
            eventContent.createDiv({ cls: 'calendar-event-desc', text: event.desc });
        }
        // Make content clickable to edit
        eventContent.addEventListener('click', () => {
            this.close();
            this.onEdit(index);
        });
        // Delete button
        const deleteBtn = eventItem.createEl('button', {
            cls: 'calendar-event-delete',
            text: 'Delete'
        });
        deleteBtn.addEventListener('click', (e) => __awaiter(this, void 0, void 0, function* () {
            e.stopPropagation();
            yield this.handleDelete(index);
        }));
    }
    handleDelete(eventIndex) {
        return __awaiter(this, void 0, void 0, function* () {
            yield this.eventManager.deleteEvent(this.date, eventIndex);
            this.onUpdate();
            // Refresh the modal content
            this.onOpen();
        });
    }
    onClose() {
        const { contentEl } = this;
        contentEl.empty();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRXZlbnRMaXN0TW9kYWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJFdmVudExpc3RNb2RhbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFPLEtBQUssRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUd0QyxNQUFNLE9BQU8sY0FBZSxTQUFRLEtBQUs7SUFNdkMsWUFDRSxHQUFRLEVBQ1IsWUFBMEIsRUFDMUIsSUFBWSxFQUNaLE1BQW9DLEVBQ3BDLFFBQW9CO1FBRXBCLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNYLElBQUksQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDO1FBQ2pDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2pCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO0lBQzNCLENBQUM7SUFFRCxNQUFNO1FBQ0osTUFBTSxFQUFFLFNBQVMsRUFBRSxHQUFHLElBQUksQ0FBQztRQUMzQixTQUFTLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDbEIsU0FBUyxDQUFDLFFBQVEsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1FBRWhELGNBQWM7UUFDZCxTQUFTLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxFQUFFLElBQUksRUFBRSxjQUFjLElBQUksQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFOUQsMkJBQTJCO1FBQzNCLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRTdELElBQUksTUFBTSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDdkIsU0FBUyxDQUFDLFNBQVMsQ0FBQztnQkFDbEIsR0FBRyxFQUFFLG9CQUFvQjtnQkFDekIsSUFBSSxFQUFFLHFCQUFxQjthQUM1QixDQUFDLENBQUM7U0FDSjthQUFNO1lBQ0wsTUFBTSxhQUFh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QU0sRUFBRSxDQUFDO1FBQ2hCLENBQUM7S0FBQTtJQUVELE9BQU87UUFDTCxNQUFNLEVBQUUsU0FBUyxFQUFFLEdBQUcsSUFBSSxDQUFDO1FBQzNCLFNBQVMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUNwQixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHAsIE1vZGFsIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG5pbXBvcnQgeyBFdmVudE1hbmFnZXIsIENhbGVuZGFyRXZlbnQgfSBmcm9tICcuL0V2ZW50TWFuYWdlcic7XHJcblxyXG5leHBvcnQgY2xhc3MgRXZlbnRMaXN0TW9kYWwgZXh0ZW5kcyBNb2RhbCB7XHJcbiAgcHJpdmF0ZSBldmVudE1hbmFnZXI6IEV2ZW50TWFuYWdlcjtcclxuICBwcml2YXRlIGRhdGU6IHN0cmluZztcclxuICBwcml2YXRlIG9uRWRpdDogKGV2ZW50SW5kZXg6IG51bWJlcikgPT4gdm9pZDtcclxuICBwcml2YXRlIG9uVXBkYXRlOiAoKSA9PiB2b2lkO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIGFwcDogQXBwLFxyXG4gICAgZXZlbnRNYW5hZ2VyOiBFdmVudE1hbmFnZXIsXHJcbiAgICBkYXRlOiBzdHJpbmcsXHJcbiAgICBvbkVkaXQ6IChldmVudEluZGV4OiBudW1iZXIpID0+IHZvaWQsXHJcbiAgICBvblVwZGF0ZTogKCkgPT4gdm9pZFxyXG4gICkge1xyXG4gICAgc3VwZXIoYXBwKTtcclxuICAgIHRoaXMuZXZlbnRNYW5hZ2VyID0gZXZlbnRNYW5hZ2VyO1xyXG4gICAgdGhpcy5kYXRlID0gZGF0ZTtcclxuICAgIHRoaXMub25FZGl0ID0gb25FZGl0O1xyXG4gICAgdGhpcy5vblVwZGF0ZSA9IG9uVXBkYXRlO1xyXG4gIH1cclxuXHJcbiAgb25PcGVuKCk6IHZvaWQge1xyXG4gICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XHJcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcclxuICAgIGNvbnRlbnRFbC5hZGRDbGFzcygnY2FsZW5kYXItZXZlbnQtbGlzdC1tb2RhbCcpO1xyXG5cclxuICAgIC8vIE1vZGFsIHRpdGxlXHJcbiAgICBjb250ZW50RWwuY3JlYXRlRWwoJ2gyJywgeyB0ZXh0OiBgRXZlbnRzIGZvciAke3RoaXMuZGF0ZX1gIH0pO1xyXG5cclxuICAgIC8vIEdldCBldmVudHMgZm9yIHRoaXMgZGF0ZVxyXG4gICAgY29uc3QgZXZlbnRzID0gdGhpcy5ldmVudE1hbmFnZXIuZ2V0RXZlbnRzRm9yRGF0ZSh0aGlzLmRhdGUpO1xyXG5cclxuICAgIGlmIChldmVudHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIGNvbnRlbnRFbC5jcmVhdGVEaXYoeyBcclxuICAgICAgICBjbHM6ICdjYWxlbmRhci1uby1ldmVudHMnLFxyXG4gICAgICAgIHRleHQ6ICdObyBldmVudHMgc2NoZWR1bGVkJyBcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBsaXN0Q29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdih7IGNsczogJ2NhbGVuZGFyLWV2ZW50LWxpc3QnIH0pO1xyXG5cclxuICAgICAgZXZlbnRzLmZvckVhY2goKGV2ZW50LCBpbmRleCkgPT4ge1xyXG4gICAgICAgIHRoaXMucmVuZGVyRXZlbnRJdGVtKGxpc3RDb250YWluZXIsIGV2ZW50LCBpbmRleCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENsb3NlIGJ1dHRvblxyXG4gICAgY29uc3QgYnV0dG9uQ29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdih7IGNsczogJ21vZGFsLWJ1dHRvbi1jb250YWluZXInIH0pO1xyXG4gICAgY29uc3QgY2xvc2VCdG4gPSBidXR0b25Db250YWluZXIuY3JlYXRlRWwoJ2J1dHRvbicsIHsgdGV4dDogJ0Nsb3NlJyB9KTtcclxuICAgIGNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5jbG9zZSgpKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcmVuZGVyRXZlbnRJdGVtKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIGV2ZW50OiBDYWxlbmRhckV2ZW50LCBpbmRleDogbnVtYmVyKTogdm9pZCB7XHJcbiAgICBjb25zdCBldmVudEl0ZW0gPSBjb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiAnY2FsZW5kYXItZXZlbnQtaXRlbScgfSk7XHJcbiAgICBcclxuICAgIC8vIENvbG9yIGluZGljYXRvclxyXG4gICAgY29uc3QgY29sb3JCYXIgPSBldmVudEl0ZW0uY3JlYXRlRGl2KHsgY2xzOiAnY2FsZW5kYXItZXZlbnQtY29sb3ItYmFyJyB9KTtcclxuICAgIGNvbG9yQmFyLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGV2ZW50LmNvbG9yO1xyXG5cclxuICAgIC8vIEV2ZW50IGNvbnRlbnQgKGNsaWNrYWJsZSB0byBlZGl0KVxyXG4gICAgY29uc3QgZXZlbnRDb250ZW50ID0gZXZlbnRJdGVtLmNyZWF0ZURpdih7IGNsczogJ2NhbGVuZGFyLWV2ZW50LWNvbnRlbnQnIH0pO1xyXG4gICAgXHJcbiAgICBpZiAoZXZlbnQudGltZSkge1xyXG4gICAgICBldmVudENvbnRlbnQuY3JlYXRlRGl2KHsgY2xzOiAnY2FsZW5kYXItZXZlbnQtdGltZScsIHRleHQ6IGV2ZW50LnRpbWUgfSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGV2ZW50Q29udGVudC5jcmVhdGVEaXYoeyBcclxuICAgICAgY2xzOiAnY2FsZW5kYXItZXZlbnQtdGl0bGUnLCBcclxuICAgICAgdGV4dDogZXZlbnQudGl0bGUgfHwgJ1VudGl0bGVkIEV2ZW50JyBcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBpZiAoZXZlbnQuZGVzYykge1xyXG4gICAgICBldmVudENvbnRlbnQuY3JlYXRlRGl2KHsgY2xzOiAnY2FsZW5kYXItZXZlbnQtZGVzYycsIHRleHQ6IGV2ZW50LmRlc2MgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gTWFrZSBjb250ZW50IGNsaWNrYWJsZSB0byBlZGl0XHJcbiAgICBldmVudENvbnRlbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgdGhpcy5vbkVkaXQoaW5kZXgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gRGVsZXRlIGJ1dHRvblxyXG4gICAgY29uc3QgZGVsZXRlQnRuID0gZXZlbnRJdGVtLmNyZWF0ZUVsKCdidXR0b24nLCB7IFxyXG4gICAgICBjbHM6ICdjYWxlbmRhci1ldmVudC1kZWxldGUnLFxyXG4gICAgICB0ZXh0OiAnRGVsZXRlJ1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGRlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jIChlKSA9PiB7XHJcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgIGF3YWl0IHRoaXMuaGFuZGxlRGVsZXRlKGluZGV4KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBoYW5kbGVEZWxldGUoZXZlbnRJbmRleDogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBhd2FpdCB0aGlzLmV2ZW50TWFuYWdlci5kZWxldGVFdmVudCh0aGlzLmRhdGUsIGV2ZW50SW5kZXgpO1xyXG4gICAgdGhpcy5vblVwZGF0ZSgpO1xyXG4gICAgXHJcbiAgICAvLyBSZWZyZXNoIHRoZSBtb2RhbCBjb250ZW50XHJcbiAgICB0aGlzLm9uT3BlbigpO1xyXG4gIH1cclxuXHJcbiAgb25DbG9zZSgpOiB2b2lkIHtcclxuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xyXG4gICAgY29udGVudEVsLmVtcHR5KCk7XHJcbiAgfVxyXG59Il19